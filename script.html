<script>
    async function dataFormSubmit(event) {
        event.preventDefault();

        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
        loadingModal.show();

        try {
            const form = event.target;
            const formData = new FormData(form);
            const data = {
                nname: formData.get('nname'),
                fname: formData.get('fname'),
                lname: formData.get('lname'),
                sex: formData.get('sex'),
                age: formData.get('age'),
                numpeople: formData.get('numpeople'),
                home: formData.get('home'),
                court: formData.get('court'),
                numarrest: formData.get('numarrest'),
                accusation: formData.get('accusation'),
                numarrestdate: formatDate(formData.get('numarrestdate')), // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢
                policestation: formData.get('policestation'),
                p1: formData.get('p1'),
                p2: formData.get('p2'),
                date: formatDate(formData.get('date')), // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö
                timearrest: formData.get('timearrest'),
                timerecord: formData.get('timerecord'),
                p3: formData.get('p3'),
                p4: formData.get('p4'),
            };

            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
            const file1 = document.getElementById('upFile1').files[0];
            if (file1) {
                data.upFile1 = await toBase64(file1);
                data.fileName1 = file1.name;
                data.mimeType1 = file1.type;
            }

            const file2 = document.getElementById('upFile2').files[0];
            if (file2) {
                data.upFile2 = await toBase64(file2);
                data.fileName2 = file2.name;
                data.mimeType2 = file2.type;
            }

            const file3 = document.getElementById('upFile3').files[0];
            if (file3) {
                data.upFile3 = await toBase64(file3);
                data.fileName3 = file3.name;
                data.mimeType3 = file3.type;
            }

            const file4 = document.getElementById('upFile4').files[0];
            if (file4) {
                data.upFile4 = await toBase64(file4);
                data.fileName4 = file4.name;
                data.mimeType4 = file4.type;
            }

            const file5 = document.getElementById('upFile5').files[0];
            if (file5) {
                data.upFile5 = await toBase64(file5);
                data.fileName5 = file5.name;
                data.mimeType5 = file5.type;
            }

            google.script.run
                .withSuccessHandler(() => {
                    loadingModal.hide(); // ‡∏õ‡∏¥‡∏î Modal
                    showMessageBox(); // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    document.getElementById("dataForm").reset(); // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                })
                .withFailureHandler(error => {
                    loadingModal.hide(); // ‡∏õ‡∏¥‡∏î Modal
                    alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`);
                })
                .saveData(data);
        } catch (error) {
            loadingModal.hide(); // ‡∏õ‡∏¥‡∏î Modal
            alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
        }
    }

    function toBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    function showMessageBox(docUrl) {
        const messageBox = document.getElementById("messageBox");

        messageBox.style.display = "block";
    }

    function openPasswordModal(event) {
        event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ


        // ‡πÄ‡∏õ‡∏¥‡∏î Modal
        const passwordModal = new bootstrap.Modal(document.getElementById('passwordModal'));
        passwordModal.show();
    }


    function checkPassword2() {
        const correctPassword = "33333333"; // üîë ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        const targetURL = "https://drive.google.com/drive/folders/1VVHZ8VfyOsbiKYjxpQJUUCHjH73d2u78"; // üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î
        const passwordInput = document.getElementById("password-input");
        const errorMessage = document.getElementById("error-message");

        if (passwordInput.value === correctPassword) {
            window.open(targetURL, "_blank"); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
            passwordInput.value = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            errorMessage.style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

            // ‡∏õ‡∏¥‡∏î Modal
            let modalElement = document.getElementById("passwordModal");
            let modalInstance = bootstrap.Modal.getInstance(modalElement);
            modalInstance.hide();
        } else {
            errorMessage.style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            passwordInput.value = ""; // ‚ùå ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ú‡∏¥‡∏î
        }
    }


    function resetErrorMessage() {
      document.getElementById("error-message").style.display = "none";
    }

    // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î Enter ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
    document.getElementById("password-form").addEventListener("submit", function (event) {
      event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ submit ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
      checkPassword2();
    });

    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    function closeMessageBox() {
        const messageBox = document.getElementById("messageBox");
        messageBox.style.display = "none";
    }

    function formatDate(dateStr) {
        const date = new Date(dateStr);

        // ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä (‡πÄ‡∏û‡∏¥‡πà‡∏° 543 ‡∏õ‡∏µ)
        const thaiYear = date.getFullYear() + 543;
        const monthNames = [
            '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
            '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
        ];
        const day = date.getDate();
        const month = monthNames[date.getMonth()];

        return `${day} ${month} ${thaiYear}`;
    }

    function setSex() {
        const nname = document.getElementById("nname").value;
        const sex = document.getElementById("sex");

        if (["‡∏ô‡∏≤‡∏á", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß", "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á"].includes(nname)) {
            sex.value = "‡∏´‡∏ç‡∏¥‡∏á";
        } else if (["‡∏ô‡∏≤‡∏¢", "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢"].includes(nname)) {
            sex.value = "‡∏ä‡∏≤‡∏¢";
        } else {
            sex.value = ""; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
        }
    }

</script>